<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>MiniGolf - 3 Obstacles</title>
    <style>
        body { background: #333; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        #game-container { position: relative; margin-top: 20px; }
        canvas { background: #2e7d32; border: 5px solid #5d4037; border-radius: 10px; cursor: crosshair; }
        
        .controls { display: flex; gap: 20px; margin-top: 20px; align-items: center; }
        .gauge-container { background: #555; border: 2px solid #fff; position: relative; overflow: hidden; }
        
        #power-gauge-ui { width: 30px; height: 150px; display: flex; flex-direction: column-reverse; }
        #direction-gauge-ui { width: 150px; height: 30px; }
        
        .bar { background: #ffeb3b; position: absolute; }
        #power-bar { width: 100%; bottom: 0; height: 0%; background: linear-gradient(to top, #4caf50, #ffeb3b, #f44336); }
        #direction-bar { height: 100%; left: 0; width: 5%; background: #2196f3; }
        
        .active { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .label { text-align: center; font-size: 12px; margin-bottom: 5px; }
        .win-msg { color: #4caf50; font-weight: bold; font-size: 20px; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>MiniGolf : Les 3 Bisques</h1>
    <p>Cliquez pour : 1. Puissance | 2. Angle | 3. Tirer</p>

    <div id="game-container">
        <canvas id="golfCanvas" width="800" height="400"></canvas>
    </div>

    <div class="controls">
        <div>
            <div class="label">PUISSANCE</div>
            <div id="power-gauge-ui" class="gauge-container">
                <div id="power-bar" class="bar"></div>
            </div>
        </div>
        <div>
            <div class="label">ANGLE</div>
            <div id="direction-gauge-ui" class="gauge-container">
                <div id="direction-bar" class="bar"></div>
            </div>
        </div>
        <button id="resetBtn" onclick="resetBall()" style="display:none; padding: 15px; background: #fff; cursor: pointer; border-radius: 5px;">Rejouer</button>
    </div>

    <script>
        const canvas = document.getElementById('golfCanvas');
        const ctx = canvas.getContext('2d');
        
        // Configuration de la balle, du trou et des obstacles
        let ball = { x: 80, y: 200, r: 10, vx: 0, vy: 0, friction: 0.985 };
        let hole = { x: 720, y: 200, r: 15 };
        
        // Tableau contenant nos 3 obstacles (bisques)
        let obstacles = [
            { x: 250, y: 50, w: 30, h: 150 },
            { x: 400, y: 200, w: 30, h: 150 },
            { x: 550, y: 50, w: 30, h: 150 }
        ];
        
        let gameState = "WAITING"; // WAITING, POWER, DIRECTION, MOVING, HOLE
        let powerVal = 0;
        let powerDir = 1;
        let dirVal = 50; 
        let dirSwap = 1;

        const powerBar = document.getElementById('power-bar');
        const directionBar = document.getElementById('direction-bar');

        function update() {
            if (gameState === "POWER") {
                powerVal += 1.5 * powerDir;
                if (powerVal >= 100 || powerVal <= 0) powerDir *= -1;
                powerBar.style.height = powerVal + "%";
            } 
            else if (gameState === "DIRECTION") {
                dirVal += 2 * dirSwap;
                if (dirVal >= 100 || dirVal <= 0) dirSwap *= -1;
                directionBar.style.left = dirVal + "%";
            }
            else if (gameState === "MOVING") {
                ball.x += ball.vx;
                ball.y += ball.vy;
                ball.vx *= ball.friction;
                ball.vy *= ball.friction;

                // Rebond murs extérieurs
                if (ball.x < ball.r) { ball.x = ball.r; ball.vx *= -0.8; }
                if (ball.x > canvas.width - ball.r) { ball.x = canvas.width - ball.r; ball.vx *= -0.8; }
                if (ball.y < ball.r) { ball.y = ball.r; ball.vy *= -0.8; }
                if (ball.y > canvas.height - ball.r) { ball.y = canvas.height - ball.r; ball.vy *= -0.8; }

                // Collision avec les 3 obstacles
                obstacles.forEach(obs => {
                    if (ball.x + ball.r > obs.x && ball.x - ball.r < obs.x + obs.w &&
                        ball.y + ball.r > obs.y && ball.y - ball.r < obs.y + obs.h) {
                        
                        // Détection basique de quel côté on tape pour faire rebondir correctement
                        if (ball.x < obs.x || ball.x > obs.x + obs.w) {
                            ball.vx *= -0.8;
                        } else {
                            ball.vy *= -0.8;
                        }
                    }
                });

                // Vérifier si la balle est dans le trou
                let dist = Math.hypot(ball.x - hole.x, ball.y - hole.y);
                if (dist < hole.r && Math.hypot(ball.vx, ball.vy) < 5) {
                    gameState = "HOLE";
                    ball.vx = 0; ball.vy = 0;
                    ball.x = hole.x; ball.y = hole.y; // Centrer dans le trou
                    document.getElementById('resetBtn').style.display = "block";
                }

                // Arrêt de la balle si trop lente
                if (Math.abs(ball.vx) < 0.1 && Math.abs(ball.vy) < 0.1) {
                    ball.vx = 0; ball.vy = 0;
                    if (gameState !== "HOLE") gameState = "WAITING";
                }
            }
            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dessiner le trou
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.beginPath();
            ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(hole.x, hole.y, hole.r - 2, 0, Math.PI * 2);
            ctx.fill();

            // Dessiner les obstacles (Bisques)
            ctx.fillStyle = "#5d4037";
            obstacles.forEach(obs => {
                ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
                // Petit effet de relief
                ctx.strokeStyle = "#3e2723";
                ctx.strokeRect(obs.x, obs.y, obs.w, obs.h);
            });

            // Dessiner la balle
            ctx.save();
            ctx.shadowBlur = 5;
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();

            // Ligne de visée
            if (gameState === "DIRECTION" || gameState === "POWER") {
                ctx.beginPath();
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = "rgba(255,255,255,0.5)";
                ctx.moveTo(ball.x, ball.y);
                let angle = (dirVal - 50) * 0.03; 
                ctx.lineTo(ball.x + 100, ball.y + (angle * 200));
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            if (gameState === "HOLE") {
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText("BIEN JOUÉ !", canvas.width/2 - 80, 50);
            }
        }

        window.addEventListener('mousedown', () => {
            if (gameState === "WAITING") {
                gameState = "POWER";
                document.getElementById('power-gauge-ui').classList.add('active');
            } 
            else if (gameState === "POWER") {
                gameState = "DIRECTION";
                document.getElementById('power-gauge-ui').classList.remove('active');
                document.getElementById('direction-gauge-ui').classList.add('active');
            }
            else if (gameState === "DIRECTION") {
                document.getElementById('direction-gauge-ui').classList.remove('active');
                shoot();
            }
        });

        function shoot() {
            const force = powerVal / 6;
            const angle = (dirVal - 50) * 0.03;
            
            ball.vx = force;
            ball.vy = angle * force;
            gameState = "MOVING";
        }

        function resetBall() {
            ball.x = 80; ball.y = 200;
            ball.vx = 0; ball.vy = 0;
            gameState = "WAITING";
            powerVal = 0; dirVal = 50;
            document.getElementById('resetBtn').style.display = "none";
        }

        update();
    </script>
</body>
</html>
